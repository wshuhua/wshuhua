(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{497:function(t,s,a){"use strict";a.r(s);var e=a(28),r=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h3",{attrs:{id:"_01-文件监听使用-watch"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_01-文件监听使用-watch"}},[t._v("#")]),t._v(" 01. ⽂件监听使⽤(watch)")]),t._v(" "),a("p",[t._v("轮询判断⽂件的最后编辑时间是否变化")]),t._v(" "),a("p",[t._v("某个⽂件发⽣了变化，并不会⽴刻告诉监听者，⽽是先缓存起来，等 aggregateTimeout")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("export "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//默认 false，也就是不开启")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("watch")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//只有开启监听模式时，watchOptions才有意义")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("wathcOptions")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//默认为空，不监听的文件或者文件夹，支持正则匹配")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("ignored")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token regex"}},[a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("node_modules")]),a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//监听到变化发生后会等300ms再去执行，默认300ms")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("aggregateTimeout")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("300")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//判断文件是否发生变化是通过不停询问系统指定文件有没有变化实现的，默认每秒问1000次")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("poll")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"_02-热更新"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_02-热更新"}},[t._v("#")]),t._v(" 02. 热更新")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("webpack-dev-server")])])]),t._v(" "),a("p",[t._v("WDS 不刷新浏览器")]),t._v(" "),a("p",[t._v("WDS 不输出⽂件，⽽是放在内存中")]),t._v(" "),a("p",[t._v("使⽤ "),a("code",[t._v("HotModuleReplacementPlugin")]),t._v("插件")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello-webpack"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"version"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.0.0"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"description"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Hello webpack"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"main"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"index.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"scripts"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"build"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"webpack "')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n+ ”dev"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('": "')]),t._v('webpack-dev-server --open"\n'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"keywords"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"author"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"license"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ISC"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("ul",[a("li",[a("code",[t._v("webpack-dev-middleware")])])]),t._v(" "),a("p",[t._v("WDM 将 webpack 输出的⽂件传输给服务器\n适⽤于灵活的定制场景")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[t._v("const express = require('express');\nconst webpack = require('webpack');\nconst webpackDevMiddleware = require('webpack-devmiddleware');\nconst app = express();\nconst config = require('./webpack.config.js');\nconst compiler = webpack(config);\napp.use(webpackDevMiddleware(compiler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\npublicPath"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" config.output.publicPath\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("));\napp.listen("),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" function () "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\nconsole.log('Example app listening on port "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),t._v("!\\n');\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(");\n")])])]),a("p",[t._v("webpack-dev-server只负责启动服务和前置准备工作，所有文件相关的操作都抽离到webpack-dev-middleware库了，主要是本地文件的编译和输出以及监听.")]),t._v(" "),a("h3",{attrs:{id:"_03-热更新的原理分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_03-热更新的原理分析"}},[t._v("#")]),t._v(" 03. 热更新的原理分析")]),t._v(" "),a("p",[a("img",{attrs:{src:"/images/webpack/HMR.png",alt:""}})]),t._v(" "),a("ul",[a("li",[t._v("Webpack Compile: 将 JS 编译成 Bundle")]),t._v(" "),a("li",[t._v("HMR Server: 将热更新的⽂件输出给 HMR Rumtime")]),t._v(" "),a("li",[t._v("Bundle server: 提供⽂件在浏览器的访问。正常一般访问文件是以文件目录的形式访问，Bundle server是以服务器的形式访问， 比如：localhost:8080/bundle.js 形式访问。")]),t._v(" "),a("li",[t._v("HMR Rumtime: 会被注⼊到浏览器的bundle.js 文件中，浏览器上的bundle.js 与服务器建立链接，通常这个链接是一个websocket，，更新⽂件的变化")]),t._v(" "),a("li",[t._v("bundle.js: 构建输出的⽂件")])]),t._v(" "),a("h4",{attrs:{id:"热更新的过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#热更新的过程"}},[t._v("#")]),t._v(" 热更新的过程")]),t._v(" "),a("p",[a("img",{attrs:{src:"/images/webpack/HMR2.png",alt:""}})])])}),[],!1,null,null,null);s.default=r.exports}}]);