(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{491:function(t,a,e){"use strict";e.r(a);var v=e(28),i=Object(v.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h3",{attrs:{id:"浏览器内核"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#浏览器内核"}},[t._v("#")]),t._v(" 浏览器内核")]),t._v(" "),e("p",[t._v("浏览器引擎指的是浏览器的排版引擎（layout engine），也称为浏览器引擎（brower engine），页面渲染引擎（rendering engine）或样板引擎。")]),t._v(" "),e("p",[t._v("浏览器内核可以分为两部分：")]),t._v(" "),e("ul",[e("li",[t._v("渲染引擎： 负责获取网页的内容并显示，不同的浏览器内核对网页的解析渲染也不同")]),t._v(" "),e("li",[t._v("js引擎： 负责解析 Javascript 语言，执行 javascript 语言来实现网页的动态效果")])]),t._v(" "),e("p",[t._v("目前主流的四大内核有：")]),t._v(" "),e("ul",[e("li",[t._v("Gecko: 早期被Netscape和Mozilia Firefox浏览器使用")]),t._v(" "),e("li",[t._v("Trident:微软开发,被IE4~IE11浏览器使用,但是Edge浏览器已经转向Blink")]),t._v(" "),e("li",[t._v("Webkit: 苹果基于KHTML开发,开源的,用于Safari,Goole Chrome之前也在使用Webkit引擎包含WebCore排版引擎及JavaScriptCore解析引擎）")]),t._v(" "),e("li",[t._v("Blink: 是Webkit的一个分支,Google开发,目前应用于Google Chorme,Edge,Opera等")])]),t._v(" "),e("h3",{attrs:{id:"浏览器工作原理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#浏览器工作原理"}},[t._v("#")]),t._v(" 浏览器工作原理")]),t._v(" "),e("p",[e("img",{attrs:{src:"/images/js/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.png",alt:""}})]),t._v(" "),e("p",[t._v("浏览器输入url（也就是域名）访问一个网站的时候,首先通过DNS服务器解析成对应的IP地址,浏览器第一次会拿到该网站的index.html,在解析这个html文件的时候,如果遇到link标签css文件,又会从服务器下载该css文件,如果遇到script标签javascript文件,同样也会从服务器下载该js文件。")]),t._v(" "),e("h3",{attrs:{id:"浏览器渲染过程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#浏览器渲染过程"}},[t._v("#")]),t._v(" 浏览器渲染过程")]),t._v(" "),e("p",[e("img",{attrs:{src:"/images/js/%E6%B8%B2%E6%9F%93%E6%B5%81%E7%A8%8B.png",alt:""}})]),t._v(" "),e("ul",[e("li",[t._v("当浏览器拿到index.html文件的时候,浏览器内核的"),e("code",[t._v("HTML Parser")]),t._v("转成DOM树")]),t._v(" "),e("li",[t._v("此时javascript也可以进行一些DOM操作(createElement等等),也会被转换成DOM树")]),t._v(" "),e("li",[t._v("css文件也会被浏览器内核的"),e("code",[t._v("CSS Parser")]),t._v("进行解析,生成的"),e("code",[t._v("Style Rules")]),t._v("会跟DOM树 "),e("code",[t._v("Attachment")]),t._v(" 在一起")]),t._v(" "),e("li",[t._v("通过"),e("code",[t._v("Layout")]),t._v("布局后,从而生成"),e("code",[t._v("Render Tree")]),t._v("(渲染树)")]),t._v(" "),e("li",[t._v("最后进行"),e("code",[t._v("Painting")]),t._v("元素绘制,最终"),e("code",[t._v("Display")]),t._v("进行展示.")])]),t._v(" "),e("h3",{attrs:{id:"js引擎"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#js引擎"}},[t._v("#")]),t._v(" js引擎")]),t._v(" "),e("p",[t._v("JavaScript引擎分类：")]),t._v(" "),e("ul",[e("li",[t._v("SpiderMonkey: 第一款JavaScript引擎,由BrenDan Eich开发(也就是JavaScript作者)")]),t._v(" "),e("li",[t._v("Chakra: 微软开发,用于IE浏览器")]),t._v(" "),e("li",[t._v("JavaScriptCore: WebKit中的JavaScript引擎,Apple公司开发")]),t._v(" "),e("li",[t._v("V8: Google开发的强大JavaScript引擎,也帮助Chrome从众多浏览器中脱颖而出")])]),t._v(" "),e("h3",{attrs:{id:"v8引擎的原理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#v8引擎的原理"}},[t._v("#")]),t._v(" V8引擎的原理")]),t._v(" "),e("p",[t._v("V8是用C++编写的Google开源高性能JavaScript和WebAssembly引擎,它用于Chrome和Node.js等.\n它实现ECMAScript和WebAssembly,并在Windows7或更高版本,MacOs10.12+和使用x64,IA-32,ARM或MISP处理器的Linux系统上运行。")]),t._v(" "),e("p",[e("img",{attrs:{src:"/images/js/V8%E5%BC%95%E6%93%8E.png",alt:""}})]),t._v(" "),e("p",[t._v("v8引擎通过Parse 进行词法分析，语法分析后转换成AST抽象语法树,再通过Ignition转换器将其转换成字节码。")]),t._v(" "),e("h3",{attrs:{id:"v8引擎的架构"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#v8引擎的架构"}},[t._v("#")]),t._v(" V8引擎的架构")]),t._v(" "),e("ul",[e("li",[t._v("Parse：模块会将JavaScript代码转换成AST（抽象语法树），这是因为解释器并不认识JavaScript代码(如果函数没有被调用，那么是不会被转换成AST的)")]),t._v(" "),e("li",[t._v("Ignition：可以理解为解释器（转换器），将ast 转化为字节码，同时会收集TurboFan优化所需要的信息（比如函数参数的类型信息，有了类型才能进行真实的运算）,如果函数只调用一次，Ignition会执行解释执行ByteCode;")]),t._v(" "),e("li",[t._v("TurboFan：可以理解为编译器，可以将字节码编译为CPU可以直接执行的机器码；如果一个函数被多次调用，那么就会被标记为热点函数，那么就会经过TurboFan转换成优化的机器码，提高代码的执行性能")])]),t._v(" "),e("p",[t._v("特殊场景：机器码被还原为ByteCode，后续执行函数中，函数类型发生了变化（比如sum函数原来执行的是number类型，后来执行变成了string类型），之前优化的机器码并不能正确的处理运算，就会逆向的转换成字节码")]),t._v(" "),e("h3",{attrs:{id:"v8引擎的解析"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#v8引擎的解析"}},[t._v("#")]),t._v(" V8引擎的解析")]),t._v(" "),e("p",[t._v("V8引擎的解析图\n"),e("img",{attrs:{src:"/images/js/V8%E5%BC%95%E6%93%8E%E7%9A%84%E8%A7%A3%E6%9E%90%E5%9B%BE.png",alt:""}})]),t._v(" "),e("ol",[e("li",[e("p",[t._v("Blink(浏览器内核)将js代码交给V8引擎,Stream获取到源码进行编码转换")])]),t._v(" "),e("li",[e("p",[t._v("Scanner会进行词法分析(lexical analysis),词法分析会将代码转换成tokens")])]),t._v(" "),e("li",[e("p",[t._v("tokens会被转换成AST树,经过Parser和PreParser")])])]),t._v(" "),e("ul",[e("li",[t._v("3.1 Parser就是直接将tokens转成AST树架构")]),t._v(" "),e("li",[t._v("3.2 PreParser预解析,什么时候进行预解析呢? 存在不必要的函数会进行预解析。为了提高网页的运行效率，v8引擎通过Lazy Parsing(延迟解析)，将不必要立即执行的函数进行预解析。")])]),t._v(" "),e("ol",{attrs:{start:"4"}},[e("li",[t._v("生成AST树后,会被Ignition转成字节码(bytecode),之后的过程就是代码的执行")])]),t._v(" "),e("h3",{attrs:{id:"js代码执行过程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#js代码执行过程"}},[t._v("#")]),t._v(" js代码执行过程")]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),e("ul",[e("li",[t._v("VO：Variable Object每一个执行上下文会被关联到一个变量对象称为AO")]),t._v(" "),e("li",[t._v("GO：Global Object")]),t._v(" "),e("li",[t._v("AO：Activation Object")]),t._v(" "),e("li",[t._v("ESC：执行上下文栈(Execution Context Stack,简称ECS),它是用于执行代码的调用栈")]),t._v(" "),e("li",[t._v("GEC：全局执行上下文（Global Execution Context） 全局的代码块为了执行构建的产物")]),t._v(" "),e("li",[t._v("FEC：函数执行上下文(Functional Execution Context）")])])]),t._v(" "),e("p",[t._v("js引擎会在执行代码之前,在堆内存中创建一个全局对象：GO")]),t._v(" "),e("ul",[e("li",[t._v("该对象所有的作用域(scope)都可以访问")]),t._v(" "),e("li",[t._v("里面会包含**Date,Array,String,Number,setTimeout,setInterval等等;")]),t._v(" "),e("li",[t._v("window属性指向自己")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('// GlobalObject\nvar globalObject = {\n   String: "类",\n   Date: "类",\n   setTimeout: "函数",\n   // ....\n   window: globalObject(指向本身),\n   name: undefined,\n   num1: undefined,\n   num2: undefined,\n   result: undefined\n}\n')])])]),e("h4",{attrs:{id:"执行上下文栈-调用栈"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#执行上下文栈-调用栈"}},[t._v("#")]),t._v(" 执行上下文栈(调用栈)")]),t._v(" "),e("p",[t._v("js引擎内部有一个执行上下文栈(Execution Context Stack,简称ECS),它是用于执行代码(全局的代码块)的调用栈。")]),t._v(" "),e("p",[t._v("全局的代码块为了执行会构建一个Global Execution Context(GEC)\nGEC会被放入到ECS中执行。")]),t._v(" "),e("p",[t._v("GEC被放入到ECS中里面包含两部分内容:")]),t._v(" "),e("ol",[e("li",[t._v("在代码执行前,parser转成AST的过程中,会将全局定义的变量,函数等加入到GO中,但是并不会赋值(undefined)\n这个过程也称之为变量的作用域提升(hoisting)")]),t._v(" "),e("li",[t._v("在代码执行中,对变量赋值,或者执行其他的函数。")])]),t._v(" "),e("h4",{attrs:{id:"执行函数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#执行函数"}},[t._v("#")]),t._v(" 执行函数")]),t._v(" "),e("p",[t._v("在执行的过程中执行到一个函数时,就会根据函数体创建一个函数执行上下文(Functional Execution Context/FEC),并且压入到EC Stack中.")]),t._v(" "),e("p",[t._v("FEC中包含三部分内容:")]),t._v(" "),e("ol",[e("li",[t._v("在解析函数成为AST树结构时,会创建一个Activation Object(AO):\nAO中包含形参,arguments,函数定义和指向函数对象,定义的变量")]),t._v(" "),e("li",[t._v("作用域链,由VO(在函数中就是AO对象)和父级VO组成,查找时会一层层查找")]),t._v(" "),e("li",[t._v("this绑定的值")])]),t._v(" "),e("p",[e("img",{attrs:{src:"/images/js/ECS.png",alt:""}})])])}),[],!1,null,null,null);a.default=i.exports}}]);